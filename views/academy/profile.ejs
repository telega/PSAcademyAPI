<%- include partials/header.ejs %>
<div class="container main-content">
    <div class = "row">
        <div class = "col-md-12">
            <h1 class="display-4"><span class="fa fa-user" aria-hidden="true"></span> <%=user.local.profile.firstName%> <%=user.local.profile.lastName%></h1>
        <div>
    </div>

    <div class = "row">
        <div class="col-md-12 mb-4">
        <h3>Details</h3>
            <table>
            <tbody>
                <tr>
                    <td><strong>Name: </strong><%=user.local.profile.firstName%> <%=user.local.profile.lastName%></td>
                </tr>
                <tr>
                    <td><strong>Email: </strong><%=user.local.email%></td>
                </tr>
                <tr>
                    <td><button data-toggle="modal" data-target="#updatePasswordModal" class="btn btn-warning"><span class="fa fa-key" aria-hidden="true"></span> Change Password</button></td>
                </tr>
            </tbody>
            </table>
        </div>
    </div>
    <div class = "row">
        <div class="col-md-12">
        <h2>Academy Progress</h2>
            <table width='100%' class="table table-striped">
                <thead class='thead-default'>
                    <th >Name</th>
                    <th>Level</th>
                    <th>Progress </th>
                    <th >Completed</th>
                </thead>
                <tbody>
                    <% items.forEach(function(item){%>
                    <tr>
                        <td> <%=item.name%></td>
                        <td> <%=item.type%></td>
                        <td> <%=Math.round(item.progress)%> %</td>
                        <td > <% if(item.completed){%>
                            <span class="fa fa-check text-success" aria-hidden="true"></span>
                            <%} else { %>
                            <span class="fa fa-times text-danger" aria-hidden="true"></span>
                            <%}%>
                        </td>
                    </tr>
                    <%});%>
                </tbody>
            </table>
        </div>
        </div>
          <div class="row">
      <div class="col-md-12">
      <p>
      <hr>
      <a href="/" alt="Academy Home" class="btn btn-secondary"><span class="fa fa-home" aria-hidden="true"></span> Back to Academy Home</a></p>

      </div>
      </div>
    </div>

</div>

</div>

</div>
<%- include partials/footer.ejs %>

<!-- Modals -->


<div class="modal fade" id="updatePasswordModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Change Password</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div id="pwConfirmMessage" class=" text-danger"></div>
        <form id = "editPassword">
              <div class="form-group">
                <label forid="newPassword">New Password</label>
                <input required type="password" class="form-control" id="newPassword" placeholder="New Password">
                <label forid="newPassword">Re-Enter New Password</label>
                <input required type="password" class="form-control" id="newPasswordConfirm" placeholder="New Password">
              </div>
              <button type="submit" data-user-id = "<%=user._id%>" class="btn btn-warning" id="updatePassword">Update Password</button>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="passwordUpdatedModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Password Changed</h5>
        
      </div>
      <div class="modal-body">
        <p>Your password has Been changed</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="passwordUpdatedConfirm" data-dismiss="modal">OK</button>
      </div>
    </div>
  </div>
</div>

<!-- Scripts --> 
<script src = "//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>

<script>

$(document).ready(function(){


  $("#updatePassword").on('click', function(e){
      e.preventDefault();
      if( $('#newPassword').val() == $('#newPasswordConfirm').val() ){
      var url = "/api/users/" + $(this).data('userId');
      data = {
        password: $('#newPassword').val()
      }
      $.ajax({
                type: "PUT",
                url: url,
                dataType: 'json',
                async: true,
                data: data,
                success: function (){
                  $('#updatePasswordModal').modal('hide');
                  $('#passwordUpdatedModal').modal('show');
                  //location.reload(true);                    
                }
      });
    } else {
        console.log('wfwefwe')
        $('#pwConfirmMessage').text('Passwords do not match.');
    }

    })

$("passwordUpdatedConfirm").on('click', function(e){
  e.preventDefault();
  location.reload(true);                    
})


    
})
</script>
</body>
</html>
