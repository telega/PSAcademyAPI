<%- include partials/header.ejs %>

<%function suffix(i) {
  var j = i % 10,
      k = i % 100;
  if (j == 1 && k != 11) {
      return i + "st";
  }
  if (j == 2 && k != 12) {
      return i + "nd";
  }
  if (j == 3 && k != 13) {
      return i + "rd";
  }
  return i + "th";
}%>

<div class="container main-content">
    <div class = "jumbotron">
        <h1 class='text-white display-4'>Academy by PatSnap</h1>
        <h2 class='text-white'> Welcome <%=user.local.profile.firstName%> </h2>
    </div>
    <div class = "row">
      <div class="col-md-6 mt-2">
        <p class="lead">Welcome to Academy by PatSnap. To get started, click <a href='/courses'>Browse All Courses</a> and you will be on your way to learning about the worlds of intellectual property and innovation. </p>
        <h3>Learn</h3>
        <p><a href = "/courses" class = "btn btn-primary" ><span class="fa fa-graduation-cap active" aria-hidden="true"></span> Browse All Courses</a></p>
        <h5> <span class = 'fa fa-star'></span> You have earned <%=user.local.academyScore%> Academy Point<%if(user.local.academyScore != 1){%>s<%}%>. </h5> 
        <h6> <span class="fa fa-trophy"></span> You are currently ranked <%if(user.local.academyRank == 0) {%> 
          <%=suffix(userCount)%>
          <%} else {%>
          <%=suffix(user.local.academyRank)%>
          <%}%> 
         out of <%=userCount%> Academy Users.</h6> 
      </div>
      <div class="col-md-5 ml-auto mt-2">
        <div class="card">
          <div class="card-header">Academy News</div>
            <div class="card-body">
              <h4 class="card-title"><%=options.academyNewsHeadline%></h4>
              <%-options.academyNewsText%>
            </div>
        </div>
      </div>


    </div>
     <div class = "row">
      <div class="col-md-6 mt-5">
      <h3><%=user.local.profile.firstName%>&apos;s Courses</h3>
      
      <%if(items.length){%>
      <table class="table table-striped">
                <thead class="thead-default">
                    <th>Course Name </th>
                    <th>Progress </th>
                    <th></th>
                </thead>
                <tbody>
                    <% items.forEach(function(item){ %>
                    <tr>
                        <td> <%=item.name%></td>
                        <td> <%=Math.round(item.progress)%> % </td>
                        <td> <a href = "/courses/<%=item.id%>" class = "btn btn-secondary">Resume Course</a></td>
                    </tr>
                    <%});%>
                </tbody>
            </table>
            <%} else {%>
            <p>You don't have any courses yet. <a href = "/courses">Get started here.</a></p>
            <%}%>
      </div>

      <div class="col-md-5 ml-auto mt-5">
        <div class="card">
          <div class="card-header">More from PatSnap</div>
            <div class="card-body">
             <ul id = "feed" class=""></ul>
            </div>
        </div>
        <div class="cta embed-responsive">
          <%-options.academyHomeCta%>
        </div>
      </div>
    </div>
</div>
<%- include partials/footer.ejs %>


<script src = "//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
<script>
$(document).ready(function () {

    $.ajax({
        url: 'https://blog.patsnap.com/rss.xml',
        type: 'GET',
        dataType: "xml"
    }).done(function(xml) {

        $.each($("item", xml), function(i, e) {
            if(i <= 3){
              var itemURL = ($(e).find("link"));
              // var blogURL = "<a href='" + itemURL.text() + "'>" + itemURL.text() +"</a>";
  
              var itemTitle = ($(e).find("title"));
              var blogItem = "<li class=''><a target='_blank' href ='" + itemURL.text() +  "'>" + itemTitle.text() + "</li>";
            $("#feed").append(blogItem);
          }
        }); 
    });


});

</script>
</body>
</html>
